<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluate Application</title>
</head>
<body>
    <h1>Evaluate Loan Application</h1>

    <h2>Application Details</h2>
    <p><strong>ID:</strong> {{ evaluation.application.id }}</p>
    <p><strong>Applicant Name:</strong> {{ evaluation.application.name }}</p>
    <p><strong>Loan Amount:</strong> {{ evaluation.application.amount }}</p>
    <p><strong>Status:</strong> {{ evaluation.status }}</p>

    <h2>Evaluation Form</h2>
    <form method="post">
        {% csrf_token %}
        <label for="status">Status:</label>
        <select name="status" id="status" onchange="toggleTimeslotField(this.value)">
            <option value="accept" {% if evaluation.status == "accept" %}selected{% endif %}>Accepted</option>
            <option value="interview" {% if evaluation.status == "interview" %}selected{% endif %}>Interview</option>
            <option value="reject" {% if evaluation.status == "reject" %}selected{% endif %}>Rejected</option>
            <option value="unevaluated" {% if evaluation.status == "unevaluated" %}selected{% endif %}>Not yet evaluated</option>
        </select>
        <br><br>

        <div id="timeslot-field" style="display: none;">
            <label for="timeslot">Select Timeslot:</label>
            <select name="timeslot" id="timeslot">
                <option value="">-- Select a Timeslot --</option>
                {% for timeslot in available_timeslots %}
                    <option value="{{ timeslot|date:'Y-m-d H:i:s' }}">
                        {{ timeslot|date:'D, M j, Y, H:i' }}
                    </option>
                {% endfor %}
            </select>
        </div>
        <br><br>

        <label for="notes">Notes:</label><br>
        <textarea name="notes" id="notes" rows="5" cols="40">{{ evaluation.notes }}</textarea>
        <br><br>

        <button type="submit">Submit Evaluation</button>
    </form>

    <a href="{% url 'applications' %}">Back to Applications</a>

    <script>
        function toggleTimeslotField(status) {
            const field = document.getElementById('timeslot-field');
            if (status === 'interview') {
                field.style.display = 'block';
            } else {
                field.style.display = 'none';
            }
        }

        // Initialize visibility based on current status
        document.addEventListener('DOMContentLoaded', () => {
            toggleTimeslotField(document.getElementById('status').value);
        });
    </script>
</body>
</html>
